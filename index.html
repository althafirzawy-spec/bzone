<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Blog</title> 
    <meta name="description" content="Blog Description">
    
    <link rel="canonical" href="https://bzone.pages.dev/">
    <link rel="alternate" type="application/rss+xml" title="Blog RSS Feed" href="/rss.xml">

    <meta property="og:type" content="website"> 
    <meta property="og:title" content="Blog"> 
    <meta property="og:description" content="Blog Description">
    <meta property="og:image" content="https://bzone.pages.dev/logo.png"> 
    <meta property="og:url" content="https://bzone.pages.dev/">
    <meta property="og:site_name" content="Blog">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Blog">
    <meta name="twitter:description" content="Blog Description">
    <meta name="twitter:image" content="https://bzone.pages.dev/logo.png">

    <link rel="icon" href="/favicon.ico" sizes="any">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">

    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" onload="this.onload=null;this.rel='stylesheet'">
    
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"></noscript>

  </head>
  <body>
    <div id="app"></div>
    <script type="module" src="/src/main.js"></script>

    <script type="text/javascript">
      (function() {
        if (navigator.userAgent.includes('HeadlessChrome')) {
          return;
        }

        const adDelaySeconds = 3;

        async function showFloatingAd() {
          try {
            const response = await fetch('/ads-content/floating.html');
            if (!response.ok) return;
            const adCode = await response.text();

            if (!adCode || adCode.trim().length < 10) return;

            const adContainer = document.createElement('div');
            adContainer.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 9999; background-color: white; padding: 10px; border: 1px solid #ccc; box-shadow: 0 5px 15px rgba(0,0,0,0.3);';
            
            const closeButton = document.createElement('button');
            closeButton.innerText = 'X';
            closeButton.style.cssText = 'position: absolute; top: 5px; right: 5px; background: #eee; border: 1px solid #ddd; border-radius: 50%; width: 25px; height: 25px; line-height: 25px; text-align: center; cursor: pointer; font-weight: bold; padding: 0; z-index: 10000;';
            closeButton.onclick = () => adContainer.remove();

            adContainer.innerHTML = adCode;
            adContainer.prepend(closeButton);
            document.body.appendChild(adContainer);

            adContainer.querySelectorAll('script').forEach(oldScript => {
              const newScript = document.createElement('script');
              Array.from(oldScript.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value));
              if (oldScript.innerHTML) {
                newScript.innerHTML = oldScript.innerHTML;
              }
              oldScript.parentNode.replaceChild(newScript, oldScript);
            });
          } catch(e) {}
        }

        window.addEventListener('load', () => {
          setTimeout(showFloatingAd, adDelaySeconds * 1000);
        });
      })();
    </script>

    <!-- Universal Popunder Blocker: Block semua popunder berdasarkan behavior, bukan domain spesifik -->
    <script>
      (function() {
        'use strict';
        
        // Pattern URL yang mencurigakan (popunder biasanya punya pattern ini, tidak peduli domain)
        const suspiciousPatterns = [
          /\/api\/users\?token=/i,        // Pattern seperti /api/users?token= (contoh: wayfarerorthodox.com)
          /token=[^&]{50,}/i,             // URL dengan token parameter sangat panjang (>50 chars)
          /token=.*&referer=/i,           // URL dengan token dan referer
          /referer=.*&.*&.*&/i,          // URL dengan banyak parameter (3+ &)
          /uuid=[a-f0-9-]{36}/i,          // URL dengan UUID
          /shu=[a-f0-9]{100,}/i,          // URL dengan hash panjang (seperti di contoh Anda)
          /\?.*&.*&.*&.*&.*&/i,          // URL dengan 5+ parameter (sangat mencurigakan)
        ];
        
        // Track user interaction
        let userInteracted = false;
        let lastInteractionTime = 0;
        let interactionTimeout;
        let windowBlurred = false;
        
        function markUserInteraction() {
          userInteracted = true;
          lastInteractionTime = Date.now();
          clearTimeout(interactionTimeout);
          // Reset setelah 2 detik (window untuk legitimate popup)
          interactionTimeout = setTimeout(() => {
            userInteracted = false;
          }, 2000);
        }
        
        // Track user interaction events
        ['click', 'keydown', 'touchstart', 'mousedown'].forEach(event => {
          document.addEventListener(event, markUserInteraction, { passive: true });
        });
        
        // Track window blur (popunder technique)
        window.addEventListener('blur', () => {
          windowBlurred = true;
          setTimeout(() => {
            windowBlurred = false;
          }, 100);
        }, { passive: true });
        
        // Block window.open() untuk popunder - LOGIKA UTAMA
        const originalOpen = window.open;
        window.open = function(url, target, features) {
          // 1. Block jika tidak ada user interaction (popunder behavior utama)
          if (!userInteracted) {
            console.warn('üö´ Blocked popunder (no user interaction):', url);
            return null;
          }
          
          // 2. Block jika URL mencurigakan (pattern matching - tidak peduli domain)
          if (url && suspiciousPatterns.some(pattern => pattern.test(url))) {
            console.warn('üö´ Blocked popunder (suspicious URL pattern):', url);
            return null;
          }
          
          // 3. Block jika di-trigger saat window blur (popunder technique)
          if (windowBlurred && !userInteracted) {
            console.warn('üö´ Blocked popunder (triggered during blur):', url);
            return null;
          }
          
          // 4. Block jika di-trigger terlalu lama setelah interaction (>2 detik)
          const timeSinceInteraction = Date.now() - lastInteractionTime;
          if (timeSinceInteraction > 2000) {
            console.warn('üö´ Blocked popunder (too long after interaction):', url);
            return null;
          }
          
          // 5. Block jika URL sangat panjang dengan banyak parameter (popunder signature)
          if (url && url.length > 500 && (url.match(/&/g) || []).length > 10) {
            console.warn('üö´ Blocked popunder (suspicious long URL with many params):', url.substring(0, 100) + '...');
            return null;
          }
          
          // Allow legitimate popup (melewati semua check di atas)
          return originalOpen.apply(this, arguments);
        };
        
        // Block navigation ke URL mencurigakan
        try {
          const locationDescriptor = Object.getOwnPropertyDescriptor(window, 'location');
          if (locationDescriptor && locationDescriptor.set) {
            Object.defineProperty(window, 'location', {
              set: function(url) {
                if (url && suspiciousPatterns.some(pattern => pattern.test(url))) {
                  console.warn('üö´ Blocked navigation to suspicious URL:', url);
                  return;
                }
                locationDescriptor.set.call(window, url);
              },
              get: function() {
                return window.location;
              },
              configurable: true
            });
          }
        } catch (e) {
          // Fallback jika tidak bisa override location
          console.warn('Could not override window.location:', e);
        }
        
        // Monitor dan block script injection yang mencurigakan
        const observer = new MutationObserver((mutations) => {
          mutations.forEach((mutation) => {
            mutation.addedNodes.forEach((node) => {
              if (node.nodeName === 'SCRIPT') {
                const src = node.src || '';
                const content = node.textContent || '';
                
                // Block script dengan URL mencurigakan
                if (suspiciousPatterns.some(pattern => 
                  pattern.test(src) || pattern.test(content)
                )) {
                  console.warn('üö´ Blocked suspicious script injection:', src || 'inline script');
                  node.remove();
                  return;
                }
                
                // Block script yang mengandung window.open tanpa proper checks
                if (content.includes('window.open') && 
                    !content.includes('userInteracted') && 
                    !content.includes('addEventListener') &&
                    !content.includes('click') &&
                    !content.includes('onclick')) {
                  console.warn('üö´ Blocked script with potential popunder code');
                  node.remove();
                }
              }
            });
          });
        });
        
        observer.observe(document.documentElement, {
          childList: true,
          subtree: true
        });
        
        console.log('üõ°Ô∏è Universal popunder blocker active - Blocking based on behavior patterns (not domain-specific)');
      })();
    </script>
  </body>
</html>